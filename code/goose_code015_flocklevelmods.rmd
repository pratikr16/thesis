---
title: Flock level models
---

# Source data

```{r load_dataprep}
library(maps); library(sjPlot)
source("dataprep.R")
library(mgcv)
geese$Breeding_year = as.factor(geese$Breeding_year)
fams$Breeding_year = as.factor(fams$Breeding_year)
```

# Flocksize ~ longitude

Model with flocksize as response, lon-lat, days, p.index, as predictors, others as random effects.

```{r run_glmer}

flockmod = bam(flocksize ~ lon + t_since_in + p.index + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = geese, family = gaussian)

```

```{r summary}
summary(flockmod)
```

# Number of families ~ flocksize

```{r gam_fams}
famsmod = bam(fams ~ log(flocksize) + p.index + lon + propjuv + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = fams %>% filter(flocksize>0, flocksize == N_sampled) %>% plyr::mutate(propjuv = propjuv/100), family = poisson)
```

```{r}
summary(famsmod)
```


# Juveniles in flocks

```{r}
#'run bam
gamjuvs = bam(propjuv ~ lon + flocksize + (p.index) + s(t_since_in, k = 4) + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = geese, family = binomial)

```

# Export models

```{r}
save(gamjuvs, flockmod, famsmod, mod03, mod03full, mod03.gorg, mod03.gorg.s, fams.expand.sub, fams.expand, file = "goosemods_pres.RData")
```
