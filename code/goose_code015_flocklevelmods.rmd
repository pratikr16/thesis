---
title: Flock level models
---

# Source data

```{r load_dataprep}
library(maps); library(sjPlot)
source("dataprep.R")
library(mgcv)
geese$Breeding_year = as.factor(geese$Breeding_year)
fams$Breeding_year = as.factor(fams$Breeding_year)

geese = geese %>% filter(lon < 7)
```

# Flocksize ~ longitude

Model with flocksize as response, lon-lat, days, p.index, as predictors, others as random effects.

```{r run_glmer}

flockmod = bam(flocksize ~ lon + (days) + p.index + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = geese, family = gaussian)

```

```{r summary}
summary(flockmod)
```

# Number of families ~ flocksize

```{r glmer_fams}
famsmod = bam(fams ~ flocksize + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = fams[fams$flocksize > 0,], family = poisson)
```

# Juveniles in flocks

```{r}
#'run bam
gamjuvs = bam(propjuv ~ lon + flocksize + s(p.index) + s(t_since_in) + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), data = geese, family = binomial)

```

```{r}
summary(gamjuvs)

AIC(gamjuvs)

pdf(file = "juvpropgam.pdf")
vis.gam(gamjuvs, view=c("t_since_in","p.index"), type = 'response', plot.type = "contour", color = "terrain", main = NULL)
dev.off()

save(gamjuvs, flockmod, famsmod, glmer03, mod03, mod03.gorg, file = "goosemods_pres.rdata")
```

# Do flocksizes decrease with time?

```{r}

```

