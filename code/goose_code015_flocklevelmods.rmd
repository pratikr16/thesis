
```{r}
#'load knitr
library(knitr);library(plyr);library(dplyr)

#'suppress all code output but run code
opts_chunk$set(include = FALSE)
opts_knit$set(root.dir = "~/git/thesis/code")
```


```{r load_dataprep}
library(maps);
source("dataprep.R")
library(mgcv); library(lme4)
```

#Fig 5. Effect of distance on flocks and families

```{r flockmod}
#'model for flocksizes
flockmod = glmer(flocksize ~ distkol + t_since_in + p.index + (1|Breeding_year) + (1|Observer) + (1|Food_type), data = geese)

#'model for families
famsmod = gam(fams ~ s(flocksize) + (distkol) + s(t_since_in, k = 4) + p.index + s(Breeding_year, bs = "re")+s(Observer, bs = "re")+s(Food_type, bs = "re"), data = fams, family = "poisson")
```


# Juvenile proportion

```{r run_modjuvs}
#'model for juvenile proportion of flocks from flock count data. no weather data included.

#'get complete cases
#geese = geese %>% filter(complete.cases(Breeding_year, Observer, Food_type, distkol, t_since_in, flocksize, p.index))

#'using arctic birds index
modjuvs = bam(propjuv ~ distkol + flocksize + p.index + s(t_since_in, pc = 0) + s(Breeding_year, bs = "re") + s(Observer, bs = "re") + s(Food_type, bs = "re"), family = binomial(link = logit), data = geese)

x = predict(modjuvs, type = "response", terms = "s(t_since_in)", newdata = geese, se.fit = T)

y = predict(modjuvs, type = "response", terms = "flocksize", newdata = geese, se.fit = T)

```

```{r}
summary(modjuvs)
```

# Export models

```{r}
save(modjuvs, modjuvs2, flockmod, famsmod, mod03, mod03.gorg, mod03.gorg.s, fams.expand.sub, fams.expand, file = "goosemods_pres.RData")
```
