---
title: Cleaing Data
output: 
  tufte::tufte_handout
---

```{r, include=FALSE}
#'load knitr
library(knitr)

#'suppress all code output but run code
opts_chunk$set(echo = FALSE)
opts_knit$set(root.dir = "~/git/thesis/")
```

```{r load data, include=FALSE}
#'load libs
library(readxl)
library(RColorBrewer)

#'import data
lt_geese = read_excel("~/git/thesis/Age-ratiodata-GWfG-toPratik.xlsx", 
    sheet = "Plain_table", col_types = c("text", 
        "numeric", "numeric", "numeric", 
        "numeric", "text", "text", "text", 
        "text", "numeric", "text", "text", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "text", "text", 
        "text"))
```

```{r reduce_data}
#'all records in the netherlands or nrw after than 2000

#'first keep only nl or nrw after 2000
study_site = lt_geese[lt_geese$Country == "NL"|lt_geese$Country=="NRW",]

study_site = study_site[study_site$Breeding_year >= 2001,]
```


```{r assign_time}
#'fix missing days
study_site$Day = ifelse(is.na(study_site$Day),
                        15, study_site$Day)

#'use a time column of the posixct class
study_site$time = as.POSIXct(paste(study_site$Year,
                                   study_site$Month,study_site$Day),
                             format="%Y %m %d")
#'fix flock size
study_site$Total_flock = ifelse(is.na(study_site$Total_flock),
        ifelse(is.na(study_site$N_sampled),
               study_site$N_Adult+study_site$N_Juvenile,
               study_site$N_sampled),
                        study_site$Total_flock)

#'fix juvenile percentage
study_site$`Perc-JV` = ifelse(is.na(study_site$`Perc-JV`),
          study_site$N_Juvenile*100/study_site$Total_flock,
                        study_site$`Perc-JV`)

#'check for NAs
apply(study_site, 2, function(x){sum(is.na(x))})

#export to csv
study_site = study_site[study_site$time < "2012-05-01",]
##write.csv(study_site, "~/git/thesis/data.clean.goose.csv")
```



```{r goose_ts_decomp, eval=FALSE, include=FALSE}
#'seasonal decomposition
#'flock size
flock_stl = stl(goose_ts[,c("Total_flock")], s.window = "periodic", na.action = na.omit)

#'juvprop
juv_stl = stl(goose_ts[,2], s.window = "periodic",na.action = na.omit)

#'cbind
goose_stl = cbind(flock_stl, juv_stl, time = day_seq)

#'plot
plot(flock_stl)
```



