---
title: Modelling counts of family sizes in flocks
---
```{r set_env}
#'load knitr
library(knitr);library(plyr);library(dplyr);library(data.table);library(purrr);library(ggplot2)

#'load model libs
library(gam);library(mgcv);library(gamm4);library(itsadug)

#'suppress all code output but run code
opts_chunk$set(eval = FALSE)
```

```{r load_data}
#'load data.goose.clean
source("dataprep.R")

#'remove flocksizes below 1
flock.fams$pred = as.factor(flock.fams$pred)
#flock.fams$fsize = as.factor(flock.fams$fsize)

flock.fams =  flock.fams %>% filter(flocksize > 0, lon < 10)
```

# Counts of family sizes in flocks

1. Families with more juveniles are found in the west, and, 
2. Families with more juveniles are found in smaller flocks, and,
3. Family size decreases over the winter.

or

1. Counts of larger families are higher in the west.
2. Counts of larger families are higher in smaller flocks.
3. Counts of larger families decrease over the winter.

```{r m01}
#'run a model with counts as the response. family size (fsize) is the major predictor along with number of families (fams)
m01 = gamm(count ~ fsize + fams + flocksize + s(lon) + days, random = list(pred=~1, Breeding_year=~1, Food_type=~1, Observer=~1), data = flock.fams, family = "poisson")
```


```{r s01}
summary(m01$gam)

plot(m01$gam, all.terms = T)

qqnorm(resid(m01$lme))
```

