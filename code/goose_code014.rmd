---
title: "Juvenile proportion GAMs"
output:
  beamer_presentation: 
    colortheme: seahorse
    fonttheme: structurebold
    theme: Malmoe
classoption: aspectratio=1610
fontsize: 8pt
header-includes:
  - \usepackage{color}
---

```{r, include=FALSE}
#'load knitr
library(knitr)
library(ggplot2)
library(lme4)
library(lubridate)
library(car)
library(broom)
library(gamm4)
#'suppress all code output but run code
opts_chunk$set(echo = FALSE)
opts_knit$set(root.dir = "~/git/thesis/code")
```

```{r read_data, eval=FALSE}
geese = read.csv("data.goose.clean.csv",row.names = 1)
geese$time = as.Date(geese$time)
#'assign month
geese$month = month(geese$time)
#'make percentages proportions
geese$propjuv = geese$propjuv/100

#'assign wintermonth
geese$winter_month =  c(c(1:8), geese$month)[match(geese$month, c(c(9:12,1:4), geese$month))]

#'source days since
source("days_since.r")

geese$days = days_since(geese$time)

#'source omega squared
source("mixed_mods_rsquared.r")
```

```{r random_effects_only, eval=FALSE}
#'model with only random effects
glmm01 = glmer(propjuv ~ 1 + (1|Breeding_year) + (1|winter_month) + (1|zone) + (1|Food_type) + (1|Observer) + (1|flocksize),
               data = geese, family = "binomial")
```

```{r summary_random_effects, eval=FALSE}
summary(glmm01)
#$\Omega^2$:
o2.mixed.mods(glmm01)
```

```{r year_and_refs, eval=FALSE}
#'model with only random effect
glmm02 = glmer(propjuv ~ Breeding_year + (1|winter_month) + (1|zone) + (1|Food_type) + (1|Observer) + (1|flocksize),
               data = geese, family = "binomial")
```

```{r summary_year_and_refs, message=FALSE, warning=FALSE, eval=FALSE}
summary(glmm02)
#$\Omega^2$: ```r 
o2.mixed.mods(glmm02)
```

# Model: breeding year, day, zone and random effects

```{r glmm_bryr_day_refs, eval=FALSE}
glmm05 = glmer(propjuv ~ Breeding_year+days+zone + (1|Food_type) + (1|Observer) + (1|flocksize),
               data = geese, family = "binomial")
```

```{r summary_bryr_day_refs, warning=FALSE, message=FALSE}
s1 = summary(glmm05)
s1call = s1$call
s1random = s1$varcor
s1fix = s1$coefficients
```

- Formula, with independent random effects:
```{r, echo=FALSE}
s1call
```

- Flocksize explains most of the variance due to random effects:
```{r, echo=FALSE}
s1random
```

- **Breeding year** and **days into winter** are significant predictors:
```{r, echo=FALSE}
s1fix
```

# Model: breeding year and day without zone, refs included

```{r glmm_bryr_days, eval=FALSE}
glmm06 = glmer(propjuv ~ Breeding_year+days + (1|zone) + (1|Food_type) + (1|Observer) + (1|flocksize),
               data = geese, family = "binomial")
```

- Formula, with zone as a random effect:
```{r, echo=FALSE, warning=FALSE, message=FALSE}
s2 = summary(glmm06)
s2call = s2$call
```

```{r echo=FALSE}
s2call
```


- AIC (model: ```year+days+zone, random effects```): ```r AIC(glmm05)```

- AIC (model: ```year+days, random effects```): ```r AIC(glmm06)```

- AIC increases though the model without zone has fewer terms.