---
title: Family size models
bibliography: ~/git/thesis/geese_citations.bib
fontsize: 8pt
link-citations: true
citecolor: Emerald
output: 
  pdf_document: 
    keep_tex: yes
---

```{r, include=FALSE}
#'load knitr
library(knitr)
library(lme4)
library(lubridate)
library(car)
library(broom)
library(gamm4)
library(mgcv)
library(itsadug)
#'suppress all code output but run code
opts_chunk$set(echo = FALSE)
opts_knit$set(root.dir = "~/git/thesis/code")
```

```{r read_data, eval=FALSE}
fams = read.csv("fams.csv",row.names = 1)
fams.expand = read.csv("fams.expand.csv")

#'set date
fams$time = as.Date(fams$time)
fams.expand$time = as.Date(fams.expand$time)

#'assign month
fams$month = month(fams$time)
fams.expand$month = month(fams.expand$time)

#'assign wintermonth
fams$winter_month =  c(c(1:8), fams$month)[match(fams$month, c(c(9:12,1:4), fams$month))]
#'to fams.expand
fams.expand$winter_month =  c(c(1:8), fams.expand$month)[match(fams.expand$month, c(c(9:12,1:4), fams.expand$month))]

#'source days since
source("days_since.r")

#'get days since the start of winter (Sep 1)
fams.expand$days = days_since(fams.expand$time)
fams$days = days_since(fams$time)


#'source omega squared
source("mixed_mods_rsquared.r")

#'remove zone Other
fams = fams[fams$zone != "Other",]
fams = droplevels(fams)

#'from fams.expand
fams.expand = fams.expand[fams.expand$zone != "Other",]
fams.expand = droplevels(fams.expand)
```

```{r order_zone, include=FALSE}
#'make ordered factor
fams$zone1 = as.ordered(fams$zone)
fams.expand$zone1 = as.ordered(fams.expand$zone)
#'set contrasts
contrasts(fams$zone1) = 'contr.treatment'
contrasts(fams.expand$zone1) = 'contr.treatment'
```

# Mean family size GAM

```{r meanfam_gam}
mfsgam01 = gam(meanfam ~ s(Breeding_year) + s(Breeding_year, by = zone1) + s(days) + s(days, by = zone1) + ti(Breeding_year, days, by=zone1), data = fams, family = "poisson")
```

```{r summary_mfsgam}
summary(mfsgam01)

vis.gam(mfsgam01, type = "response", theta = 50, phi = 45,
        color = "terrain", plot.type = "persp",
        main = "meanfam size", view = c("zone1","days"),
        n.grid = 20, ticktype = "detailed")
```
